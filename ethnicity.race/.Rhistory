by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop(joined_pop_est, 2, '2011' )
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = !!year)
return(df)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year))
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
df %>%
filter(Race == 2) %>%
select(State, '2011')
stitched_data <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ), filter_demo_pop(joined_pop_est, 2, '2012' ), filter_demo_pop(joined_pop_est, 2, '2013' ))
View(stitched_data)
stitched_data <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' ))
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop, ID)
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
View(combined_data)
ethnicity_data <-
inner_join(combined_data %>%
mutate(ID = paste(Year, State, sep = ', ')), black_pop_est, by = 'ID')
ethnicity_data <-
read.csv('demographic data CAP.csv') %>%
rename(Year = Ã¯..Fiscal.Year) %>%
mutate(State = as.character(trimws(State)),
c_hispanic_latinx = clean(Hispanic.or.Latino),
c_american_native = clean(American.Indian.or.Alaskan.Native),
c_asian = clean(Asian),
c_black = clean(Black.or.African.American),
c_pacific_islander = clean(Native.Hawaiian.or.Other.Pacific.Islander),
c_white = clean(White),
c_two_plus = clean(Two.or.more.races),
c_unknown = clean(Race.ethnicity.unknown)) %>%
select(Year, State, c_hispanic_latinx, c_american_native, c_asian, c_black, c_pacific_islander, c_white, c_two_plus, c_unknown) %>%
#deselects the Native American P&A
mutate(ID = factor(paste(Year, State, c_american_native, sep = ', '))) %>%
filter(ID != '2015, New Mexico, 6') %>%
filter(ID != '2016, New Mexico, 6') %>%
filter(ID != '2017, New Mexico, 4') %>%
filter(ID != '2018, New Mexico, 2') %>%
#joins the two Connecticut options together
mutate(ID = factor(paste(Year, State, c_white, sep = ', '))) %>%
mutate(c_white = replace(c_white,
ID == '2017, Connecticut, 29',
37)) %>%
filter(ID != '2017, Connecticut, 8') %>%
#joins the two DC options together
mutate(c_hispanic_latinx = replace(c_hispanic_latinx,
ID == '2011, District of Columbia, 9',
4)) %>%
mutate(c_black = replace(c_black,
ID == '2011, District of Columbia, 9',
66)) %>%
mutate(c_white = replace(c_white,
ID == '2011, District of Columbia, 9',
24)) %>%
mutate(c_two_plus = replace(c_two_plus,
ID == '2011, District of Columbia, 9',
2)) %>%
mutate(c_unknown = replace(c_unknown,
ID == '2011, District of Columbia, 9',
2)) %>%
filter(ID != '2011, District of Columbia, 15') %>%
#joins the two NEvada options
mutate(c_hispanic_latinx = replace(c_hispanic_latinx,
ID == '2013, Nevada, 7',
3)) %>%
mutate(c_black = replace(c_black,
ID == '2013, Nevada, 7',
9)) %>%
mutate(c_white = replace(c_white,
ID == '2013, Nevada, 7',
27)) %>%
mutate(c_two_plus = replace(c_two_plus,
ID == '2013, Nevada, 7',
1)) %>%
filter(ID != '2013, Nevada, 20') %>%
#joins the two new yourk options
mutate(c_hispanic_latinx = replace(c_hispanic_latinx,
ID == '2013, New York, 76',
31)) %>%
mutate(c_asian = replace(c_asian,
ID == '2013, New York, 76',
14)) %>%
mutate(c_black = replace(c_black,
ID == '2013, New York, 76',
86)) %>%
mutate(c_white = replace(c_white,
ID == '2013, New York, 76',
141)) %>%
mutate(c_two_plus = replace(c_two_plus,
ID == '2013, New York, 76',
3)) %>%
mutate(c_unknown = replace(c_unknown,
ID == '2013, New York, 76',
37)) %>%
filter(ID != '2013, New York, 65') %>%
#joins the South Carolina options
mutate(c_black = replace(c_black,
ID == '2015, South Carolina, 52',
60)) %>%
mutate(c_pacific_islander = replace(c_pacific_islander,
ID == '2015, South Carolina, 52',
1)) %>%
mutate(c_white = replace(c_white,
ID == '2015, South Carolina, 52',
66)) %>%
mutate(c_two_plus = replace(c_two_plus,
ID == '2015, South Carolina, 52',
3)) %>%
filter(ID != '2015, South Carolina, 14') %>%
#changed ID to allow joining
mutate(ID = as.character(paste0(Year, State, sep = ', '))) %>%
select(-Year, -State) %>%
rename(n_hispanic_latinx = c_hispanic_latinx,
n_american_native = c_american_native,
n_asian = c_asian,
n_black = c_black,
n_pacific_islander = c_pacific_islander,
n_white = c_white,
n_two_plus = c_two_plus,
n_unknown = c_unknown)
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data %>%
mutate(ID = paste(Year, State, sep = ', ')), black_pop_est, by = 'ID')
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
View(combined_data)
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
View(ethnicity_data)
remove(census_est, combined_data, joined_pop_est, workload_w_state)
remove(census_est, combined_data, joined_pop_est, workload_w_state, black_pop_est)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4))
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4))
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4)) %>%
mutate(black_clients = round(n_black / a_individuals_served, 4))
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4)) %>%
mutate(black_clients = round(n_black / a_total_indiv, 4))
black_client_exp <-
select(State, Year, black_per_pop, black_clients)
black_client_exp <-
select(State, Year, black_per_pop, black_clients)
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients)
View(black_client_exp)
#analysis
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients) %>%
mutate(underserved = black_per_pop > black_clients)
#analysis
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients) %>%
mutate(underserved = black_per_pop > black_clients) %>%
filter(underserved)
black_client_exp %>% group_by(State) %>% summarise(n())
black_client_exp %>% group_by(State) %>% summarise(n()) %>% arrange()
black_client_exp %>% group_by(State) %>% summarise(n = n()) %>% arrange(n)
black_client_exp %>% group_by(State) %>% summarise(n = n()) %>% arrange(desc(n))
