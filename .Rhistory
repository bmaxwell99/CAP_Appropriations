year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data %>%
mutate(ID = paste(Year, State, sep = ', ')), black_pop_est, by = 'ID')
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
View(combined_data)
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
filter_demo_pop(joined_pop_est, 2, '2011' )
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID')
View(ethnicity_data)
remove(census_est, combined_data, joined_pop_est, workload_w_state)
remove(census_est, combined_data, joined_pop_est, workload_w_state, black_pop_est)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4))
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4))
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
census_est <-
read.csv('sc-est2018-alldata6.csv') %>%
filter(SEX == 0, ORIGIN == 1)
sum_by_demo <- function(col, year){
#returns
col <- enquo(col)
year <- enquo(year)
df <-
census_est %>%
group_by(NAME, RACE) %>%
summarise(x = sum(!!col)) %>%
mutate(ID = paste(NAME, RACE, sep = ', ')) %>%
ungroup() %>%
select(-NAME, -RACE)
return(df)
}
#nested join group in combo with the above function
joined_pop_est <- inner_join(sum_by_demo(POPESTIMATE2011, 2011),
inner_join(sum_by_demo(POPESTIMATE2012, 2012),
inner_join(sum_by_demo(POPESTIMATE2013, 2013),
inner_join(sum_by_demo(POPESTIMATE2014, 2014),
inner_join(sum_by_demo(POPESTIMATE2015, 2015),
inner_join(sum_by_demo(POPESTIMATE2016, 2016),
inner_join(sum_by_demo(POPESTIMATE2017, 2017),
sum_by_demo(POPESTIMATE2018, 2018),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID'),
by = 'ID') %>%
separate(ID, c('State', 'Race'),sep = ", ") %>%
rename('2011' = x.x.x.x.x,
'2012' = x.y,
'2013' = x.x.x.x,
'2014' = x.y.y,
'2015' = x.x.x,
'2016' = x.y.y.y,
'2017' = x.x,
'2018' = x.y.y.y.y
)
filter_demo_pop<- function(df, race, year){
year <- enquo(year)
df <-
df %>%
filter(Race == race) %>%
select(State, !!year) %>%
mutate(Year = as.numeric(!!year)) %>%
rename(pop_est = !!year)
return(df)
}
black_pop_est <- rbind(filter_demo_pop(joined_pop_est, 2, '2011' ),
filter_demo_pop(joined_pop_est, 2, '2012' ),
filter_demo_pop(joined_pop_est, 2, '2013' ),
filter_demo_pop(joined_pop_est, 2, '2014' ),
filter_demo_pop(joined_pop_est, 2, '2015' ),
filter_demo_pop(joined_pop_est, 2, '2016' ),
filter_demo_pop(joined_pop_est, 2, '2017' ),
filter_demo_pop(joined_pop_est, 2, '2018' )) %>%
rename(black_pop_est = pop_est) %>%
mutate(ID = paste(State, Year, sep = ', ')) %>%
select(black_pop_est, ID)
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4)) %>%
mutate(black_clients = round(n_black / a_individuals_served, 4))
ethnicity_data <-
inner_join(combined_data, black_pop_est, by = 'ID') %>%
mutate(black_per_pop = round(black_pop_est / pop, 4)) %>%
mutate(black_clients = round(n_black / a_total_indiv, 4))
black_client_exp <-
select(State, Year, black_per_pop, black_clients)
black_client_exp <-
select(State, Year, black_per_pop, black_clients)
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients)
View(black_client_exp)
#analysis
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients) %>%
mutate(underserved = black_per_pop > black_clients)
#analysis
black_client_exp <-
ethnicity_data %>%
select(State, Year, black_per_pop, black_clients) %>%
mutate(underserved = black_per_pop > black_clients) %>%
filter(underserved)
black_client_exp %>% group_by(State) %>% summarise(n())
black_client_exp %>% group_by(State) %>% summarise(n()) %>% arrange()
black_client_exp %>% group_by(State) %>% summarise(n = n()) %>% arrange(n)
black_client_exp %>% group_by(State) %>% summarise(n = n()) %>% arrange(desc(n))
bar_plot_ethnicity <-
ggplot(data = ethnicity_summary)+
aes(fill = fund_cat)+
geom_bar()+
labs(x = 'Difference Between Ratio of Client Ethnicity and
Ratio of State Ethnicity',
fill = 'Grouped by
Funding Category',
y= 'number of States') +
theme(axis.text.y = element_blank()) +
scale_fill_hue(h = c(0, 270))
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations/ethnicity.race")
source('workload_calc.R')
setwd("C:/Users/dark_/Documents/NDRN/CAP_Appropriations")
source('workload_calc.R')
territory_work <-
indiv_cases_stdzed %>%
select(Year, State, agency_name, workload) %>%
filter(is.element(State, c('Guam', 'American Samoa', 'Virgin Islands', 'Northern Marianas'))) %>%
mutate(ID = paste(trimws(State), trimws(Year), trimws(agency_name), sep = ', '))
territory_ir <-
I_R_data %>%
filter(is.element(State, c('Guam', 'American Samoa', 'Virgin Islands', 'Northern Marianas'))) %>%
select(-State)
territory_data <-
inner_join(territory_work, territory_ir, by = 'ID') %>%
mutate(funding = 59477,
indiv_helped = workload + total_i_r + indiv_trained) %>%
select(Year, State, funding, workload, total_i_r, indiv_trained, indiv_helped)
people_data <-
combined_data %>%
select(Year, State, funding, workload, total_i_r, indiv_trained, indiv_helped)
people_data <-
rbind(people_data, territory_data)
people_sum <-
people_data %>%
group_by(Year) %>%
summarise(funding = sum(funding),
workload = sum(workload),
total_i_r = sum(total_i_r),
indiv_trained = sum(indiv_trained),
indiv_helped = sum(indiv_helped)
)
View(people_data)
people_data %>% mutate(ID = paste(State, Year, sep = ', ')) %>% distinct(ID) %>% View()
people_data %>% mutate(ID = paste(State, Year, sep = ', ')) %>% distinct(ID) %>% View()
people_data %>%slice(-9)
%>%slice(-9)
source('~/NDRN/CAP_Appropriations/people_impacted.R', echo=TRUE)
people_data<-
people_data%>%
slice(-9)
cor(people_data$total_i_r, people_data$workload, method = 'kendall')
cor.test(people_data$total_i_r, people_data$workload, method = 'kendall')
cor.test(people_data$indiv_trained, people_data$workload, method = 'kendall')
cor.test(people_data$indiv_trained, people_data$workload, method = 'kendall', use = 'pairwise')
cor(people_data$indiv_trained, people_data$workload, method = 'kendall', use = 'pairwise')
cor(people_data$total_i_r, people_data$indiv_trained, method = 'kendall')
cor.test(people_data$total_i_r, people_data$indiv_trained, method = 'kendall')
cor(people_data$total_i_r, people_data$indiv_trained)
cor(people_data$total_i_r, people_data$workload)
cor.test(people_data$total_i_r, people_data$workload)
cor.test(people_data$indiv_trained, people_data$workload)
cor.test(people_data$indiv_trained, people_data$total_i_r)
ggplot(people_data) +
aes(x = total_i_r,
y = workload) +
geom_point()
ggplot(people_data) +
aes(x = log(total_i_r),
y = workload) +
geom_point()
post_2014 <-
people_data %>%
filter(year > 2014)
post_2014 <-
people_data %>%
filter(Year > 2014)
cor.test(post_2014$total_i_r, post_2014$total_i_r, method = 'kendall')
cor(post_2014$total_i_r, post_2014$workload, method = 'kendall')
cor.test(post_2014$total_i_r, post_2014$workload, method = 'kendall')
cor.test(post_2014$indiv_trained, post_2014$workload, method = 'kendall')
cor.test(post_2014$indiv_trained, post_2014$total_i_r, method = 'kendall')
cor.test(post_2014$indiv_trained, post_2014$workload, method = 'kendall')
cor.test(post_2014$indiv_trained, post_2014$workload)
cor.test(post_2014$total_i_r, post_2014$workload)
cor.test(post_2014$total_i_r, post_2014$indiv_trained)
ggplot(post_2014) +
aes(x = total_i_r,
y = workload) +
geom_point()
ggplot(post_2014) +
aes(x = total_i_r,
y = workload,
label = State) +
geom_text()
ggplot(post_2014) +
aes(x = log(total_i_r),
y = workload,
label = State) +
geom_text()
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
#no surprises its california
ggplot(post_2014) +
aes(x = total_i_r,
y = workload,
label = State) +
geom_text()
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
post_2014 <-
people_data %>%
filter(Year > 2014) %>%
filter(State != 'California')
cor.test(post_2014$total_i_r, post_2014$workload, use = 'kendall')
cor.test(post_2014$total_i_r, post_2014$workload)
cor.test(post_2014$total_i_r %>% log(), post_2014$workload %>% log())
cor.test(post_2014$total_i_r %>% lapply(log()), post_2014$workload )
cor.test( lapply(log(people_data$total_i_r)), post_2014$workload )
#someone is very different from other states
ggplot(post_2014) +
aes(x = total_i_r,
y = workload) +
geom_point()
#someone is very different from other states
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload)) +
geom_point()
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
#let's try a log scale for both axis
ggplot(post_2014 %>%  filter(State == 'Rhode Island')) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
#let's try a log scale for both axis
ggplot(post_2014 %>%  filter(State == 'Rhode Island')) +
aes(x = total_i_r,
y = workload,
label = State) +
geom_text()
#let's try a log scale for both axis
ggplot(post_2014 %>%  filter(State == 'Rhode Island')) +
aes(x = total_i_r,
y = workload,
label = State,
color = factor(Year)) +
geom_text()
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
post_2014 <-
people_data %>%
filter(Year > 2014)
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
source('~/NDRN/CAP_Appropriations/people_impacted.R', echo=TRUE)
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_point()
post_2014 <-
people_data %>%
filter(Year > 2014)
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_point()
#let's try a log scale for both axis
ggplot(post_2014) +
aes(x = log(total_i_r),
y = log(workload),
label = State) +
geom_text()
